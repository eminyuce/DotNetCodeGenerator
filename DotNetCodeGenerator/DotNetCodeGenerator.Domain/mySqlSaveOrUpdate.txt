CREATE PROCEDURE `sp_SaveOrUpdateCurrency_config`(


  IN currency_config_id INT,
  IN buy_at_price float,
  IN buy_on_percent float,
  IN order_timeout_in_hour float,
  IN buyable bit(1),
  IN currency_pair varchar(255) ,
  IN sell_at_price float,
  IN sell_on_percent float,
  IN sellable bit(1),
  IN usable_balance_percent float,
  IN bot_user int(11)
  
)
BEGIN

START TRANSACTION;
 
 
 
  
 IF EXISTS (select * from `polbot2`.`currency_config` where `currency_config_id` = @currency_config_id) THEN
  
  
 
 UPDATE `polbot2`.`currency_config2`
SET
`buy_at_price` =  COALESCE(@buy_at_price, 0),
`buy_on_percent` =  COALESCE(@buy_on_percent, 0),
`order_timeout_in_hour` =  COALESCE(@order_timeout_in_hour, 0),
`buyable` =  COALESCE(@buyable, 0),
`currency_pair` =  COALESCE(@currency_pair, 'btc_xtz'),
`sell_at_price` =  COALESCE(@sell_at_price, 0),
`sell_on_percent` =  COALESCE(@sell_on_percent, 0),
`sellable` =  COALESCE(@sellable, 0),
`usable_balance_percent` =  COALESCE(@usable_balance_percent, 0),
`bot_user` =  COALESCE(@bot_user, 0)
WHERE `currency_config_id` =  COALESCE(@currency_config_id, 0);




  
  ELSE 
  
  SET SQL_MODE = '';

  INSERT INTO `polbot2`.`currency_config2`
(`currency_config_id`,
`buy_at_price`,
`buy_on_percent`,
`order_timeout_in_hour`,
`buyable`,
`currency_pair`,
`sell_at_price`,
`sell_on_percent`,
`sellable`,
`usable_balance_percent`,
`bot_user`)
VALUES
(@currency_config_id,
COALESCE(@buy_at_price, 0),
COALESCE(@buy_on_percent,0),
COALESCE(@order_timeout_in_hour,0),
COALESCE(@buyable,0),
COALESCE(@currency_pair,'btc_xtz'),
COALESCE(@sell_at_price,0),
COALESCE(@sell_on_percent,0),
COALESCE(@sellable,0),
COALESCE(@usable_balance_percent,0),
COALESCE(@bot_user,0));

  SELECT LAST_INSERT_ID();
 
   END IF;
   
 
COMMIT;
		
END




CREATE TABLE `currency_config2` (
  `currency_config_id` int(11) NOT NULL AUTO_INCREMENT,
  `buy_at_price` float NOT NULL,
  `buy_on_percent` float NOT NULL,
  `order_timeout_in_hour` float DEFAULT NULL,
  `buyable` bit(1) NOT NULL,
  `currency_pair` varchar(255) DEFAULT NULL,
  `sell_at_price` float NOT NULL,
  `sell_on_percent` float NOT NULL,
  `sellable` bit(1) NOT NULL,
  `usable_balance_percent` float NOT NULL,
  `bot_user` int(11) DEFAULT NULL,
  PRIMARY KEY (`currency_config_id`)
) ENGINE=InnoDB AUTO_INCREMENT=46 DEFAULT CHARSET=utf8;

